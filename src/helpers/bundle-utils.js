// Generated by CoffeeScript 2.5.1
import { v4 as uuidv4 } from 'uuid';
export var fixAllRefs = function (resources, subs) {
  var fixed, i, j, len, resource;
  fixed = [];

  for (i = j = 0, len = resources.length; j < len; i = ++j) {
    resource = resources[i];

    if (resource.toJS) {
      resource = resource.toJS();
    }

    this.fixRefs(resource, subs);
    fixed.push(resource);
  }

  return fixed;
};
export var fixRefs = function (resource, subs) {
  var _notDate, _walkNode, count;

  count = 0;

  _notDate = function (value) {
    return !(value instanceof Date);
  };

  _walkNode = function (node) {
    var j, k, len, results, results1, sub, v;

    if (node instanceof Array) {
      results = [];

      for (j = 0, len = node.length; j < len; j++) {
        v = node[j];
        results.push(_walkNode(v));
      }

      return results;
    } else if (typeof node === "object" && _notDate(node)) {
      results1 = [];

      for (k in node) {
        v = node[k];

        if (k !== "reference") {
          results1.push(_walkNode(v));
        } else if (v) {
          results1.push(function () {
            var l, len1, results2;
            results2 = [];

            for (l = 0, len1 = subs.length; l < len1; l++) {
              sub = subs[l];

              if (!(v && sub.from && v.toUpperCase() === sub.from.toUpperCase())) {
                continue;
              }

              if (sub.to) {
                node[k] = sub.to;
              }

              results2.push(count += 1);
            }

            return results2;
          }());
        } else {
          results1.push(void 0);
        }
      }

      return results1;
    }
  };

  _walkNode(resource);

  return count;
};
export var countRefs = function (resources, ref) {
  var count, hasRefs, j, len, resource;
  count = 0;

  for (j = 0, len = resources.length; j < len; j++) {
    resource = resources[j];
    hasRefs = this.fixRefs(resource, [{
      from: ref
    }]);

    if (hasRefs !== 0) {
      count += 1;
    }
  }

  return count;
};
export var buildFredId = function (nextId) {
  return `FRED-${nextId}`;
};
export var findNextId = function (entries) {
  var entry, id, j, len, matches, maxId, ref1;
  maxId = 1;

  for (j = 0, len = entries.length; j < len; j++) {
    entry = entries[j];

    if (id = ((ref1 = entry.resource) != null ? ref1.id : void 0) || entry.id) {
      if (matches = id.match(/^fred\-(\d+)/i)) {
        maxId = Math.max(maxId, parseInt(matches[1]) + 1);
      }
    }
  }

  return maxId;
};
export var parseBundle = function (bundle, clearInternalIds) {
  var entry, entryPos, fromId, idSubs, j, l, len, len1, ref1, ref2, resourceType, resources, toId;
  idSubs = [];
  entryPos = this.findNextId(bundle.entry);
  ref1 = bundle.entry;

  for (j = 0, len = ref1.length; j < len; j++) {
    entry = ref1[j];

    if (entry.fullUrl && /^urn:uuid:/.test(entry.fullUrl) || !entry.resource.id || clearInternalIds) {
      resourceType = entry.resource.resourceType;
      fromId = entry.resource.id || entry.fullUrl;
      entry.resource.id = toId = this.buildFredId(entryPos);
      idSubs.push({
        from: fromId,
        to: `${resourceType}/${toId}`
      });
      entryPos++;
    }
  }

  resources = [];
  ref2 = bundle.entry;

  for (l = 0, len1 = ref2.length; l < len1; l++) {
    entry = ref2[l];
    this.fixRefs(entry.resource, idSubs);
    resources.push(entry.resource);
  }

  return resources;
};
export var generateBundle = function (resources = [], splicePos = null, spliceData) {
  var bundle, entries, entry, fromId, fullUrl, idSubs, j, l, len, len1, request, resource, toId;

  if (splicePos !== null) {
    resources = resources.splice(splicePos, 1, spliceData);
  }

  idSubs = [];
  entries = [];

  for (j = 0, len = resources.length; j < len; j++) {
    resource = resources[j];

    if (resource.toJS) {
      resource = resource.toJS();
    }

    if (resource.id && !/^[Ff][Rr][Ee][Dd]\-\d+/.test(resource.id)) {
      fullUrl = `${resource.resourceType}/${resource.id}`;
      request = {
        method: "PUT",
        url: fullUrl
      };
    } else {
      fullUrl = `urn:uuid:${uuidv4()}`;
      request = {
        method: "POST",
        url: resource.resourceType
      };

      if (resource.id) {
        fromId = `${resource.resourceType}/${resource.id}`;
        toId = fullUrl;
        idSubs.push({
          from: fromId,
          to: toId
        });
        delete resource.id;
      }
    }

    entries.push({
      fullUrl: fullUrl,
      request: request,
      resource: resource
    });
  }

  for (l = 0, len1 = entries.length; l < len1; l++) {
    entry = entries[l];
    this.fixRefs(entry.resource, idSubs);
  }

  return bundle = {
    resourceType: "Bundle",
    type: "transaction",
    meta: {
      lastUpdated: new Date().toISOString(),
      fhir_comments: ["Generated by FRED"]
    },
    entry: entries
  };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9oZWxwZXJzL2J1bmRsZS11dGlscy5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLFNBQVMsRUFBQSxJQUFULE1BQUEsUUFBQSxNQUFBO0FBSUEsT0FBQSxJQUFPLFVBQUEsR0FBYSxVQUFBLFNBQUEsRUFBQSxJQUFBLEVBQUE7QUFDcEIsTUFBQSxLQUFBLEVBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEVBQUEsUUFBQTtBQUFDLEVBQUEsS0FBQSxHQUFRLEVBQVI7O0FBQ0EsT0FBQSxDQUFBLEdBQUEsQ0FBQSxHQUFBLENBQUEsRUFBQSxHQUFBLEdBQUEsU0FBQSxDQUFBLE1BQUEsRUFBQSxDQUFBLEdBQUEsR0FBQSxFQUFBLENBQUEsR0FBQSxFQUFBLENBQUEsRUFBQTs7O0FBQ0MsUUFBOEIsUUFBUSxDQUF0QyxJQUFBLEVBQUE7QUFBQSxNQUFBLFFBQUEsR0FBVyxRQUFRLENBQW5CLElBQVcsRUFBWDs7O0FBQ0EsU0FBQSxPQUFBLENBQUEsUUFBQSxFQUFBLElBQUE7QUFDQSxJQUFBLEtBQUssQ0FBTCxJQUFBLENBQUEsUUFBQTtBQUhEOztBQUlBLFNBQU8sS0FBUDtBQU5tQixDQUFwQjtBQVNBLE9BQUEsSUFBTyxPQUFBLEdBQVUsVUFBQSxRQUFBLEVBQUEsSUFBQSxFQUFBO0FBQ2pCLE1BQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxLQUFBOztBQUFDLEVBQUEsS0FBQSxHQUFRLENBQVI7O0FBQ0EsRUFBQSxRQUFBLEdBQVcsVUFBQSxLQUFBLEVBQUE7YUFDVixLQUFBLFlBQXFCLEk7QUFEWCxHQUFYOztBQUdBLEVBQUEsU0FBQSxHQUFZLFVBQUEsSUFBQSxFQUFBO0FBQ2IsUUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUEsUUFBQSxFQUFBLEdBQUEsRUFBQSxDQUFBOztBQUFFLFFBQUcsSUFBQSxZQUFILEtBQUEsRUFBQTtBQUNDLE1BQUEsT0FBQSxHQUFBLEVBQUE7O0FBQUEsV0FBQSxD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SUFBQyxFQUFELENBQWIsV0FBYSxFQUFiO0FBQ0EsTUFBQSxhQUFBLEVBQWUsQ0FBQSxtQkFBQTtBQURmLEtBSEQ7QUFLQSxJQUFBLEtBQUEsRUFBTztBQUxQLEdBREQ7QUE5QnVCLENBQXhCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdjQgYXMgdXVpZHY0IH0gZnJvbSAndXVpZCdcblxuXG5cbmV4cG9ydCBmaXhBbGxSZWZzID0gKHJlc291cmNlcywgc3VicykgLT5cblx0Zml4ZWQgPSBbXVxuXHRmb3IgcmVzb3VyY2UsIGkgaW4gcmVzb3VyY2VzXG5cdFx0cmVzb3VyY2UgPSByZXNvdXJjZS50b0pTKCkgaWYgcmVzb3VyY2UudG9KU1xuXHRcdEBmaXhSZWZzKHJlc291cmNlLCBzdWJzKVxuXHRcdGZpeGVkLnB1c2ggcmVzb3VyY2Vcblx0cmV0dXJuIGZpeGVkXG5cblxuZXhwb3J0IGZpeFJlZnMgPSAocmVzb3VyY2UsIHN1YnMpIC0+XG5cdGNvdW50ID0gMFxuXHRfbm90RGF0ZSA9ICh2YWx1ZSkgLT5cblx0XHR2YWx1ZSBub3QgaW5zdGFuY2VvZiBEYXRlXG5cblx0X3dhbGtOb2RlID0gKG5vZGUpIC0+XG5cdFx0aWYgbm9kZSBpbnN0YW5jZW9mIEFycmF5XG5cdFx0XHRfd2Fsa05vZGUgdiBmb3IgdiBpbiBub2RlXG5cblx0XHRlbHNlIGlmIHR5cGVvZiBub2RlIGlzIFwib2JqZWN0XCIgYW5kIF9ub3REYXRlKG5vZGUpXG5cdFx0XHRmb3IgaywgdiBvZiBub2RlXG5cdFx0XHRcdGlmIGsgaXNudCBcInJlZmVyZW5jZVwiXG5cdFx0XHRcdFx0X3dhbGtOb2RlIHZcblx0XHRcdFx0ZWxzZSBpZiB2XG5cdFx0XHRcdFx0Zm9yIHN1YiBpbiBzdWJzIHdoZW4gdiBhbmQgc3ViLmZyb20gYW5kIFxuXHRcdFx0XHRcdFx0di50b1VwcGVyQ2FzZSgpIGlzIHN1Yi5mcm9tLnRvVXBwZXJDYXNlKClcblx0XHRcdFx0XHRcdFx0bm9kZVtrXSA9IHN1Yi50byBpZiBzdWIudG9cblx0XHRcdFx0XHRcdFx0Y291bnQgKz0gMVxuXG5cdF93YWxrTm9kZShyZXNvdXJjZSlcblx0cmV0dXJuIGNvdW50XG5cblxuZXhwb3J0IGNvdW50UmVmcyA9IChyZXNvdXJjZXMsIHJlZikgLT5cblx0Y291bnQgPSAwXG5cdGZvciByZXNvdXJjZSBpbiByZXNvdXJjZXNcblx0XHRoYXNSZWZzID0gQGZpeFJlZnMgcmVzb3VyY2UsIFt7ZnJvbTogcmVmfV1cblx0XHRpZiBoYXNSZWZzIGlzbnQgMCB0aGVuIGNvdW50ICs9IDFcblx0cmV0dXJuIGNvdW50XG5cblxuZXhwb3J0IGJ1aWxkRnJlZElkID0gKG5leHRJZCkgLT5cblx0cmV0dXJuIFwiRlJFRC0je25leHRJZH1cIlxuXG5cbmV4cG9ydCBmaW5kTmV4dElkID0gKGVudHJpZXMpIC0+XG5cdG1heElkID0gMVxuXHRmb3IgZW50cnkgaW4gZW50cmllc1xuXHRcdGlmIGlkID0gZW50cnkucmVzb3VyY2U/LmlkIHx8IGVudHJ5LmlkXG5cdFx0XHRpZiBtYXRjaGVzID0gaWQubWF0Y2ggL15mcmVkXFwtKFxcZCspL2lcblx0XHRcdFx0bWF4SWQgPSBNYXRoLm1heCBtYXhJZCwgcGFyc2VJbnQobWF0Y2hlc1sxXSkrMVxuXHRyZXR1cm4gbWF4SWRcblxuXG5leHBvcnQgcGFyc2VCdW5kbGUgPSAoYnVuZGxlLCBjbGVhckludGVybmFsSWRzKSAtPlxuXHRpZFN1YnMgPSBbXVxuXHRlbnRyeVBvcyA9IEBmaW5kTmV4dElkKGJ1bmRsZS5lbnRyeSlcblx0Zm9yIGVudHJ5IGluIGJ1bmRsZS5lbnRyeVxuXHRcdGlmIChlbnRyeS5mdWxsVXJsIGFuZCAvXnVybjp1dWlkOi8udGVzdCBlbnRyeS5mdWxsVXJsKSBvclxuXHRcdFx0IWVudHJ5LnJlc291cmNlLmlkIG9yIGNsZWFySW50ZXJuYWxJZHNcblx0XHRcdFx0cmVzb3VyY2VUeXBlID0gZW50cnkucmVzb3VyY2UucmVzb3VyY2VUeXBlXG5cdFx0XHRcdGZyb21JZCA9IGVudHJ5LnJlc291cmNlLmlkIHx8IGVudHJ5LmZ1bGxVcmxcblx0XHRcdFx0ZW50cnkucmVzb3VyY2UuaWQgPSB0b0lkID0gQGJ1aWxkRnJlZElkKGVudHJ5UG9zKVxuXHRcdFx0XHRpZFN1YnMucHVzaCB7ZnJvbTogZnJvbUlkLCB0bzogXCIje3Jlc291cmNlVHlwZX0vI3t0b0lkfVwifVxuXHRcdFx0XHRlbnRyeVBvcysrXG5cblxuXHRyZXNvdXJjZXMgPSBbXVxuXHRmb3IgZW50cnkgaW4gYnVuZGxlLmVudHJ5XG5cdFx0QGZpeFJlZnMoZW50cnkucmVzb3VyY2UsIGlkU3Vicylcblx0XHRyZXNvdXJjZXMucHVzaCBlbnRyeS5yZXNvdXJjZVxuXHRyZXR1cm4gcmVzb3VyY2VzXG5cblxuZXhwb3J0IGdlbmVyYXRlQnVuZGxlID0gKHJlc291cmNlcz1bXSwgc3BsaWNlUG9zPW51bGwsIHNwbGljZURhdGEpIC0+XG5cdGlmIHNwbGljZVBvcyBpc250IG51bGxcblx0XHRyZXNvdXJjZXMgPSByZXNvdXJjZXMuc3BsaWNlKHNwbGljZVBvcywgMSwgc3BsaWNlRGF0YSlcblxuXHRpZFN1YnMgPSBbXVxuXHRlbnRyaWVzID0gW11cblx0Zm9yIHJlc291cmNlIGluIHJlc291cmNlc1xuXHRcdHJlc291cmNlID0gcmVzb3VyY2UudG9KUygpIGlmIHJlc291cmNlLnRvSlNcblxuXHRcdGlmIHJlc291cmNlLmlkIGFuZCAhL15bRmZdW1JyXVtFZV1bRGRdXFwtXFxkKy8udGVzdChyZXNvdXJjZS5pZClcblx0XHRcdGZ1bGxVcmwgPSBcIiN7cmVzb3VyY2UucmVzb3VyY2VUeXBlfS8je3Jlc291cmNlLmlkfVwiXG5cdFx0XHRyZXF1ZXN0ID0ge21ldGhvZDogXCJQVVRcIiwgdXJsOiBmdWxsVXJsfVxuXHRcdGVsc2Vcblx0XHRcdGZ1bGxVcmwgPSBcInVybjp1dWlkOiN7dXVpZHY0KCl9XCJcblx0XHRcdHJlcXVlc3QgPSB7bWV0aG9kOiBcIlBPU1RcIiwgdXJsOiByZXNvdXJjZS5yZXNvdXJjZVR5cGV9XG5cblx0XHRcdGlmIHJlc291cmNlLmlkXG5cdFx0XHRcdGZyb21JZCA9IFwiI3tyZXNvdXJjZS5yZXNvdXJjZVR5cGV9LyN7cmVzb3VyY2UuaWR9XCJcblx0XHRcdFx0dG9JZCA9IGZ1bGxVcmxcblx0XHRcdFx0aWRTdWJzLnB1c2gge2Zyb206IGZyb21JZCwgdG86IHRvSWR9XG5cdFx0XHRcdGRlbGV0ZSByZXNvdXJjZS5pZFxuXG5cdFx0ZW50cmllcy5wdXNoXG5cdFx0XHRmdWxsVXJsOiBmdWxsVXJsXG5cdFx0XHRyZXF1ZXN0OiByZXF1ZXN0XG5cdFx0XHRyZXNvdXJjZTogcmVzb3VyY2Vcblx0XG5cdGZvciBlbnRyeSBpbiBlbnRyaWVzXG5cdFx0QGZpeFJlZnMoZW50cnkucmVzb3VyY2UsIGlkU3VicykgXG5cdFxuXHRyZXR1cm4gYnVuZGxlID0gXG5cdFx0cmVzb3VyY2VUeXBlOiBcIkJ1bmRsZVwiXG5cdFx0dHlwZTogXCJ0cmFuc2FjdGlvblwiXG5cdFx0bWV0YTpcblx0XHRcdGxhc3RVcGRhdGVkOiAobmV3IERhdGUoKSkudG9JU09TdHJpbmcoKVxuXHRcdFx0Zmhpcl9jb21tZW50czogW1wiR2VuZXJhdGVkIGJ5IEZSRURcIl1cblx0XHRlbnRyeTogZW50cmllc1xuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbiJdLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
//# sourceURL=/scratch/beapen/fred/src/helpers/bundle-utils.coffee